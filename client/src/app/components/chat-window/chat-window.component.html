@if(chatService.currentOpenedChat() || chatService.currentOpenedGroup()){
<div class="flex flex-col h-full bg-slate-50 relative">

    <div
        class="h-18 bg-white border-b border-gray-100 flex items-center justify-between px-6 shadow-sm z-20 shrink-0">

        <div class="flex items-center gap-4">

            @if(chatService.currentOpenedChat(); as user){
            <div class="relative">
                <img [src]="user.profileImage || 'assets/default-avatar.png'"
                    class="w-11 h-11 rounded-full object-cover border-2 border-white shadow-sm ring-1 ring-gray-100"
                    onerror="this.src='assets/default-avatar.png'">

                <div class="absolute bottom-0.5 right-0.5 w-3 h-3 border-2 border-white rounded-full"
                    [ngClass]="chatService.status(user.userName) === 'online' ? 'bg-green-500' : 'bg-gray-300'">
                </div>
            </div>

            <div class="flex flex-col">
                <span class="font-bold text-gray-800 text-base leading-tight">
                    {{ user.fullName | titlecase }}
                </span>
                <span class="text-xs font-medium mt-0.5 transition-colors duration-300" [ngClass]="{
                        'text-green-600': chatService.status(user.userName) === 'online',
                        'text-blue-600': chatService.status(user.userName) === 'Yazıyor...',
                        'text-gray-400': chatService.status(user.userName) === 'offline'
                      }">
                    {{ chatService.status(user.userName) | titlecase }}
                </span>
            </div>
            }

            @if(chatService.currentOpenedGroup(); as group){
            <div class="relative">
                <img [src]="group.groupImage ? 'http://localhost:5000' + group.groupImage : 'assets/default-group.png'"
                    class="w-11 h-11 rounded-xl object-cover border-2 border-white shadow-sm ring-1 ring-gray-100"
                    onerror="this.src='assets/default-group.png'">

                <div class="absolute -bottom-1 -right-1 bg-white rounded-full p-0.5 shadow-sm border border-gray-50">
                    <mat-icon class="text-blue-600" style="font-size: 14px; width: 14px; height: 14px;">group</mat-icon>
                </div>
            </div>

            <div class="flex flex-col">
                <span class="font-bold text-gray-800 text-base leading-tight">
                    {{ group.groupName | titlecase }}
                </span>
                <span class="text-xs text-gray-500 font-medium mt-0.5 truncate max-w-62.5">
                    {{ group.description || 'Grup Sohbeti' }}
                </span>
            </div>
            }
        </div>

        <div class="flex items-center gap-1">
            <button mat-icon-button
                class="text-gray-400 hover:text-blue-600 hover:bg-blue-50 transition-colors rounded-full">
                <mat-icon>search</mat-icon>
            </button>
            <button mat-icon-button
                class="text-gray-400 hover:text-blue-600 hover:bg-blue-50 transition-colors rounded-full">
                <mat-icon>video_call</mat-icon>
            </button>
            <button mat-icon-button
                class="text-gray-400 hover:text-gray-700 hover:bg-gray-100 transition-colors rounded-full">
                <mat-icon>more_vert</mat-icon>
            </button>
        </div>
    </div>

    <div class="flex-1 overflow-hidden relative bg-[#f8fafc]">
        <div class="absolute inset-0 opacity-[0.03] pointer-events-none"
            style="background-image: radial-gradient(#64748b 1px, transparent 1px); background-size: 24px 24px;">
        </div>

        <app-chat-box class="h-full w-full block" />
    </div>

    <div class="bg-white p-4 border-t border-gray-100 shrink-0 z-20">
        <div class="flex items-end gap-2 max-w-5xl mx-auto">

            <input type="file" #fileInput (change)="onFileSelected($event)" style="display: none;">
            <button (click)="fileInput.click()"
                class="mb-1 p-2.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-all duration-200"
                matTooltip="Dosya Ekle">
                <mat-icon class="transform rotate-45">attach_file</mat-icon>
            </button>

            <div
                class="flex-1 relative bg-gray-50 rounded-2xl border border-gray-200 focus-within:bg-white focus-within:border-blue-400 focus-within:ring-4 focus-within:ring-blue-50 transition-all duration-300">
                <textarea type="text" [(ngModel)]="message" (input)="chatService.notifyTyping()"
                    (keydown.enter)="sendMessage(); $event.preventDefault()" rows="1"
                    class="w-full bg-transparent border-none focus:ring-0 text-gray-700 placeholder:text-gray-400 py-3 pl-4 pr-12 resize-none max-h-32 overflow-y-auto"
                    placeholder="Bir mesaj yazın..." style="min-height: 48px;"></textarea>

                <button class="absolute right-3 bottom-2.5 text-gray-400 hover:text-yellow-500 transition-colors">
                    <mat-icon style="font-size: 20px; width: 20px; height: 20px;">sentiment_satisfied_alt</mat-icon>
                </button>
            </div>

            <button (click)="sendMessage()" [disabled]="!message && !fileInput.value"
                class="mb-1 p-3 rounded-xl bg-blue-600 text-white shadow-lg shadow-blue-200 hover:bg-blue-700 hover:shadow-blue-300 hover:scale-105 active:scale-95 disabled:bg-gray-200 disabled:text-gray-400 disabled:shadow-none disabled:scale-100 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center">
                <mat-icon class="ml-0.5">send</mat-icon>
            </button>
        </div>
    </div>

</div>
} @else {
<div class="flex flex-col items-center justify-center h-full bg-white relative overflow-hidden">
    <div
        class="absolute top-0 left-0 w-64 h-64 bg-blue-50 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob">
    </div>
    <div
        class="absolute top-0 right-0 w-64 h-64 bg-purple-50 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000">
    </div>

    <div class="relative z-10 text-center px-6">
        <div class="w-32 h-32 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm">
            <mat-icon class="text-blue-500" style="font-size: 64px; width: 64px; height: 64px;">forum</mat-icon>
        </div>

        <h2 class="text-2xl font-bold text-gray-800 mb-2 tracking-tight">Hoş Geldiniz!</h2>
        <p class="text-gray-500 max-w-xs mx-auto leading-relaxed">
            Mesajlaşmaya başlamak için sol menüden bir sohbet seçin veya kullanıcı adınızı yanındaki 3 nokta kısmından yeni bir grup oluşturun.
        </p>
    </div>
</div>
}